{% extends 'base.html' %}

{% block title %}قائمة جهات الاتصال{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h2">قائمة جهات الاتصال</h1>
  <a href="{{ url_for('main.add_contact') }}" class="btn btn-primary">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
      <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
    </svg>
    إضافة جهة اتصال جديدة
  </a>
</div>

<div class="card">
  <div class="card-body">
    <div class="mb-3">
        <input type="text" id="searchInput" class="form-control" placeholder="ابحث بالاسم أو رقم الهاتف...">
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th scope="col">الاسم</th>
            <th scope="col">رقم الهاتف</th>
            <th scope="col">المصدر</th>
            <th scope="col">تاريخ الإضافة</th>
          </tr>
        </thead>
        <tbody id="contactsTableBody">
          {% for contact in contacts %}
          <tr>
            <td>{{ contact.name }}</td>
            <td>{{ contact.phone }}</td>
            <td>{{ contact.source or 'غير محدد' }}</td>
            <td>{{ contact.created_at.strftime('%Y-%m-%d') }}</td>
          </tr>
          {% else %}
          <tr id="no-contacts-row">
            <td colspan="4" class="text-center">لا توجد جهات اتصال حتى الآن. <a href="{{ url_for('main.add_contact') }}">أضف واحدة الآن</a>.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        const tableBody = document.getElementById('contactsTableBody');
        const rows = tableBody.getElementsByTagName('tr');
        const noContactsRow = document.getElementById('no-contacts-row');

        searchInput.addEventListener('keyup', function() {
            const filter = searchInput.value.toLowerCase();
            let visibleRows = 0;
            for (let i = 0; i < rows.length; i++) {
                // Skip the 'no contacts' row
                if (rows[i].id === 'no-contacts-row') continue;

                let nameCell = rows[i].cells[0];
                let phoneCell = rows[i].cells[1];

                if (nameCell && phoneCell) {
                    let nameText = nameCell.textContent || nameCell.innerText;
                    let phoneText = phoneCell.textContent || phoneCell.innerText;
                    if (nameText.toLowerCase().indexOf(filter) > -1 || phoneText.toLowerCase().indexOf(filter) > -1) {
                        rows[i].style.display = "";
                        visibleRows++;
                    } else {
                        rows[i].style.display = "none";
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}
